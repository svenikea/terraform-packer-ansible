on: 
  pull_request:
    paths:
      - ansible/**
jobs:
  ansible-lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout base branch
        uses: actions/checkout@v3
        with:
          ref: '${{ github.event.pull_request.base.ref }}'

      - name: Setup Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Setup Ansible
        run: |
          python -m pip install --upgrade pip
          pip install ansible ansible-lint
      
      - name: Run ansible-lint on bastion playbook
        run: ansible-lint ansible/setup-bastion.yml --skip-list skip_ansible_lint --skip-list yaml[new-line-at-end-of-file]

      - name: Run ansible-lint on app playbook
        run: ansible-lint ansible/setup-app.yml --skip-list skip_ansible_lint --skip-list yaml[new-line-at-end-of-file]
      
  # ansible-run:
  #   needs: ansible-lint
  #   runs-on: ubuntu-latest
  #   container:
  #     image: amazonlinux:latest
  #   steps:
  #     - name: Execute bastion playbook
  #       uses: ansible/ansible-lint-action@v6.11.0
  #       with:
  #         playbook: setup-bastion.yml
  #         directory: ansible/
  #         options: |
  #           --inventory dev
  #           --verbose

  #     - name: Execute app playbook
  #       uses: dawidd6/action-ansible-playbook@v2
  #       with:
  #         playbook: setup-app.yml
  #         directory: ansible/
  #         options: |
  #           --inventory dev
  #           --verbose
    